import nmap
import logging
from datetime import datetime

# Function to setup logger
def setup_logger(name, log_file, level=logging.INFO):
    """Function to setup as many loggers as you want"""
    formatter = logging.Formatter('%(asctime)s - %(message)s')
    handler = logging.FileHandler(log_file)        
    handler.setFormatter(formatter)

    logger = logging.getLogger(name)
    logger.setLevel(level)
    logger.addHandler(handler)

    return logger

# Example logger setup
scanner_logger = setup_logger('scanner_logger', 'scan_results.log')

# Initialize the PortScanner object
scanner = nmap.PortScanner()

print("Welcome, this is a simple Nmap scanning tool")
print("---------------------------------------------")
ip = input("Please enter the IP address to be scanned: ")
print("The IP you entered is:", ip)

# Prompt the user for the type of scan
resp = input('''\nPlease enter the type of scan you want to run:
                 1) SYN ACK Scan
                 2) UDP Scan
                 3) Comprehensive Scan
                 ''')
print("You have selected option:", resp)

# Function to log and print results
def log_and_print(message):
    print(message)
    scanner_logger.info(message)

if resp == '1':
    log_and_print(f"Nmap version: {scanner.nmap_version()}")
    scanner.scan(ip, '1-1024', '-v -sS')
    log_and_print(f"Scan Info: {scanner.scaninfo()}")
    log_and_print(f"IP status: {scanner[ip].state()}")
    log_and_print(f"Protocols: {scanner[ip].all_protocols()}")
    if 'tcp' in scanner[ip]:
        log_and_print(f"Open TCP Ports: {list(scanner[ip]['tcp'].keys())}")
    else:
        log_and_print("No open TCP ports found.")

elif resp == '2':
    log_and_print(f"Nmap version: {scanner.nmap_version()}")
    scanner.scan(ip, '1-1024', '-v -sU')
    log_and_print(f"Scan Info: {scanner.scaninfo()}")
    log_and_print(f"IP status: {scanner[ip].state()}")
    log_and_print(f"Protocols: {scanner[ip].all_protocols()}")
    if 'udp' in scanner[ip]:
        log_and_print(f"Open UDP Ports: {list(scanner[ip]['udp'].keys())}")
    else:
        log_and_print("No open UDP ports found.")

elif resp == '3':
    log_and_print(f"Nmap version: {scanner.nmap_version()}")
    scanner.scan(ip, '1-500', '-v -sS -sV -sC -A -O')
    log_and_print(f"Scan Info: {scanner.scaninfo()}")
    log_and_print(f"IP status: {scanner[ip].state()}")
    log_and_print(f"Protocols: {scanner[ip].all_protocols()}")
    if 'tcp' in scanner[ip]:
        log_and_print(f"Open TCP Ports: {list(scanner[ip]['tcp'].keys())}")
    else:
        log_and_print("No open TCP ports found.")
else:
    log_and_print("Please enter a valid input.")
